<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Timetable & Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .task-item.completed {
            text-decoration: line-through;
            opacity: 0.5;
        }
        
        /* Glassmorphism Effect */
        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-container {
             background: rgba(26, 32, 44, 0.2);
             border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .list-item-enter {
             animation: fadeInUp 0.4s ease-out forwards;
        }
        
        /* Modal Animation */
        @keyframes modalScaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        #timetableModal.active > div {
            animation: modalScaleIn 0.3s ease-out forwards;
        }
        
        /* Input Focus Glow */
        input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }

        /* Current Class Indicator */
        .current-class-indicator {
            width: 10px;
            height: 10px;
            background-color: #10B981; /* Emerald-500 */
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto max-w-3xl mt-12 mb-12 p-6 glass-container rounded-2xl shadow-lg fade-in-up">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white">College Timetable & Task Manager</h1>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Your schedule for Semester 5, Section A.</p>
        </header>

        <!-- Today's Schedule -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-200">Today's Schedule</h2>
            <ul id="todaysScheduleList" class="space-y-3">
                <!-- Today's classes will be dynamically added here -->
            </ul>
             <button id="viewTimetableBtn" class="w-full mt-4 flex items-center justify-center gap-2 bg-gray-600 text-white font-semibold py-3 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                View Full Timetable
            </button>
        </div>

        <!-- Form to Add Personal Task -->
        <div class="bg-white/50 dark:bg-gray-700/50 p-6 rounded-xl mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-200">Add a Personal Task</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="taskInput" placeholder="Enter a new task..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                <input type="datetime-local" id="reminderTime" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
            </div>
            <button id="addTaskBtn" class="w-full mt-4 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                Add Personal Task
            </button>
        </div>

        <!-- Personal Task List -->
        <div>
            <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-200">Your Personal Tasks</h2>
            <ul id="taskList" class="space-y-3">
                <!-- Personal tasks will be dynamically added here -->
            </ul>
        </div>
    </div>

    <!-- Timetable Modal -->
    <div id="timetableModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4">
        <div class="glass-container rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Full Weekly Timetable</h2>
                <button id="closeModalBtn" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-3xl font-bold">&times;</button>
            </div>
            <div id="timetable-container" class="overflow-x-auto">
                <!-- Timetable will be generated here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const taskInput = document.getElementById('taskInput');
            const reminderTimeInput = document.getElementById('reminderTime');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const taskList = document.getElementById('taskList');
            const todaysScheduleList = document.getElementById('todaysScheduleList');
            const viewTimetableBtn = document.getElementById('viewTimetableBtn');
            const timetableModal = document.getElementById('timetableModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const timetableContainer = document.getElementById('timetable-container');

            // --- TIMETABLE DATA ---
            const timetableData = {
                // Monday
                1: [
                    { start: '08:00', end: '09:00', subject: 'SE&PM', instructor: 'Mrs. Shilpa K C' },
                    { start: '09:00', end: '10:00', subject: 'Library', instructor: '' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '11:30', subject: 'RM&IPR', instructor: 'Mrs. Afshan Mohammadi' },
                    { start: '11:30', end: '12:30', subject: 'CV', instructor: 'Dr. Likewin Thomas' },
                    { start: '12:30', end: '13:30', subject: 'LUNCH', instructor: '' },
                    { start: '13:30', end: '14:30', subject: 'Mentoring', instructor: '' },
                    { start: '14:30', end: '16:30', subject: 'NSS', instructor: 'Ms. Tejaswini N D' }
                ],
                // Tuesday
                2: [
                    { start: '08:00', end: '10:00', subject: 'RM&IPR', instructor: 'Mrs. Afshan Mohammadi' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '12:30', subject: 'DV Lab(B2)/CN Lab(B1)', instructor: '' },
                    { start: '12:30', end: '13:30', subject: 'LUNCH', instructor: '' },
                    { start: '13:30', end: '14:30', subject: 'NSS', instructor: 'Ms. Tejaswini N D' },
                    { start: '14:30', end: '16:30', subject: 'Mini Project', instructor: 'All Faculty' }
                ],
                // Wednesday
                3: [
                    { start: '08:00', end: '09:00', subject: 'CN', instructor: 'Mrs. Poornima B P & Ms. Shilpa M I' },
                    { start: '09:00', end: '10:00', subject: 'EVS', instructor: 'New Faculty' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '12:30', subject: 'SE&PM Lab', instructor: '' },
                    { start: '12:30', end: '13:30', subject: 'LUNCH', instructor: '' },
                    { start: '13:30', end: '14:30', subject: 'Remedial', instructor: '' },
                    { start: '14:30', end: '16:30', subject: 'Mini Project', instructor: 'All Faculty' }
                ],
                // Thursday
                4: [
                    { start: '08:00', end: '09:00', subject: 'RM&IPR', instructor: 'Mrs. Afshan Mohammadi' },
                    { start: '09:00', end: '10:00', subject: 'CV', instructor: 'Dr. Likewin Thomas' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '11:30', subject: 'CN', instructor: 'Mrs. Poornima B P & Ms. Shilpa M I' },
                    { start: '11:30', end: '12:30', subject: 'SE&PM', instructor: 'Mrs. Shilpa K C' },
                    { start: '12:30', end: '13:30', subject: 'LUNCH', instructor: '' },
                    { start: '13:30', end: '14:30', subject: 'TC', instructor: 'Mrs. Tejaswini N D' }
                ],
                // Friday
                5: [
                    { start: '08:00', end: '09:00', subject: 'TC', instructor: 'Mrs. Tejaswini N D' },
                    { start: '09:00', end: '10:00', subject: 'CN', instructor: 'Mrs. Poornima B P & Ms. Shilpa M I' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '11:30', subject: 'SE&PM', instructor: 'Mrs. Shilpa K C' },
                    { start: '11:30', end: '12:30', subject: 'CV', instructor: 'Dr. Likewin Thomas' },
                    { start: '12:30', end: '13:30', subject: 'LUNCH', instructor: '' },
                    { start: '13:30', end: '15:30', subject: 'Forum Activity', instructor: '' }
                ],
                // Saturday
                6: [
                    { start: '08:00', end: '10:00', subject: 'DV Lab(B1)/CN Lab(B2)', instructor: '' },
                    { start: '10:00', end: '10:30', subject: 'BREAK', instructor: '' },
                    { start: '10:30', end: '11:30', subject: 'RM&IPR', instructor: 'Mrs. Afshan Mohammadi' },
                    { start: '11:30', end: '12:30', subject: 'TC', instructor: 'Mrs. Tejaswini N D' }
                ]
            };
            const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

            // --- NOTIFICATION & REMINDER LOGIC ---
            const requestNotificationPermission = () => {
                if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') console.log('Notification permission granted.');
                    });
                }
            };
            
            const setReminder = (taskText, reminderTime, isClass = false) => {
                if (!reminderTime) return;

                const reminderDateTime = new Date(reminderTime).getTime();
                const now = new Date().getTime();
                const timeUntilReminder = reminderDateTime - now;

                if (timeUntilReminder > 0) {
                    setTimeout(() => {
                        if (Notification.permission === 'granted') {
                            new Notification(isClass ? 'Class Starting Soon!' : 'Task Reminder', {
                                body: taskText,
                                icon: 'https://placehold.co/64x64/3B82F6/FFFFFF?text=🔔'
                            });
                        }
                    }, timeUntilReminder);
                }
            };

            // --- TODAY'S SCHEDULE LOGIC ---
            const isCurrentTimeInRange = (start, end) => {
                const now = new Date();
                const startTime = new Date();
                const [startHours, startMinutes] = start.split(':');
                startTime.setHours(startHours, startMinutes, 0, 0);

                const endTime = new Date();
                const [endHours, endMinutes] = end.split(':');
                endTime.setHours(endHours, endMinutes, 0, 0);

                return now >= startTime && now < endTime;
            }

            const loadTodaysSchedule = () => {
                const todayIndex = new Date().getDay();
                const todaysClasses = timetableData[todayIndex] || [];
                
                if (todaysClasses.length === 0) {
                    todaysScheduleList.innerHTML = `<li class="p-4 bg-gray-50/50 dark:bg-gray-700/50 rounded-lg text-center text-gray-500 dark:text-gray-400">No classes scheduled for today.</li>`;
                    return;
                }

                todaysClasses.forEach(cls => {
                    if (cls.subject.toLowerCase() === 'break' || cls.subject.toLowerCase() === 'lunch') return;

                    const li = document.createElement('li');
                    const isCurrent = isCurrentTimeInRange(cls.start, cls.end);
                    li.className = `flex items-center justify-between p-4 ${isCurrent ? 'bg-green-100 dark:bg-green-900/50' : 'bg-blue-50 dark:bg-blue-900/50'} rounded-lg shadow-sm list-item-enter`;
                    
                    const indicator = isCurrent ? '<div class="current-class-indicator mr-3"></div>' : '';

                    const content = `
                        <div class="flex items-center flex-grow">
                            ${indicator}
                            <div>
                                <p class="font-bold ${isCurrent ? 'text-green-800 dark:text-green-200' : 'text-blue-800 dark:text-blue-200'}">${cls.subject}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${cls.instructor}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-gray-800 dark:text-gray-200">${cls.start} - ${cls.end}</p>
                        </div>`;
                    li.innerHTML = content;
                    todaysScheduleList.appendChild(li);

                    // Set a 10-minute reminder before the class starts
                    const [hours, minutes] = cls.start.split(':');
                    const reminderDate = new Date();
                    reminderDate.setHours(hours, minutes, 0, 0);
                    reminderDate.setMinutes(reminderDate.getMinutes() - 10);
                    
                    setReminder(`Your ${cls.subject} class is starting in 10 minutes.`, reminderDate.toISOString(), true);
                });
            };

            // --- PERSONAL TASK LOGIC ---
            const loadTasks = () => {
                const tasks = JSON.parse(localStorage.getItem('personalTasks')) || [];
                tasks.forEach(task => createTaskElement(task.text, task.time, task.completed));
                checkReminders();
            };

            const saveTasks = () => {
                const tasks = [];
                document.querySelectorAll('#taskList .task-item').forEach(taskItem => {
                    tasks.push({
                        text: taskItem.querySelector('.task-text').textContent,
                        time: taskItem.dataset.time,
                        completed: taskItem.classList.contains('completed')
                    });
                });
                localStorage.setItem('personalTasks', JSON.stringify(tasks));
            };

            const createTaskElement = (taskText, reminderTime, isCompleted) => {
                const li = document.createElement('li');
                li.className = `task-item flex items-center justify-between p-4 bg-gray-50/50 dark:bg-gray-700/50 rounded-lg shadow-sm list-item-enter ${isCompleted ? 'completed' : ''}`;
                li.dataset.time = reminderTime;

                let reminderText = '';
                if (reminderTime) {
                    reminderText = `<small class="text-gray-500 dark:text-gray-400 block">Reminder: ${new Date(reminderTime).toLocaleString()}</small>`;
                }

                li.innerHTML = `
                    <div>
                        <span class="task-text">${taskText}</span>
                        ${reminderText}
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="complete-btn bg-green-500 text-white w-8 h-8 rounded-full hover:bg-green-600 transition transform hover:scale-110">✓</button>
                        <button class="delete-btn bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600 transition transform hover:scale-110">✗</button>
                    </div>`;
                
                taskList.appendChild(li);
            };
            
            taskList.addEventListener('click', (e) => {
                if (e.target.classList.contains('complete-btn')) {
                    e.target.closest('.task-item').classList.toggle('completed');
                }
                if (e.target.classList.contains('delete-btn')) {
                    const item = e.target.closest('.task-item');
                    item.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        item.remove();
                        saveTasks();
                    }, 300);
                } else {
                    saveTasks();
                }
            });

            const addTask = () => {
                const taskText = taskInput.value.trim();
                const reminderTime = reminderTimeInput.value;
                if (taskText === '') return;

                createTaskElement(taskText, reminderTime, false);
                saveTasks();
                setReminder(taskText, reminderTime, false);

                taskInput.value = '';
                reminderTimeInput.value = '';
            };
            
            const checkReminders = () => {
                 const tasks = JSON.parse(localStorage.getItem('personalTasks')) || [];
                 tasks.forEach(task => {
                     if(!task.completed) setReminder(task.text, task.time, false);
                 });
            };

            // --- MODAL & TIMETABLE DISPLAY LOGIC ---
            const generateTimetableHTML = () => {
                let tableHTML = `<table class="w-full text-sm text-left text-gray-500 dark:text-gray-400 border-collapse">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50/50 dark:bg-gray-700/50 dark:text-gray-400">
                        <tr>
                            <th scope="col" class="px-6 py-3 rounded-tl-lg">Day</th>
                            <th scope="col" class="px-6 py-3">Time</th>
                            <th scope="col" class="px-6 py-3">Subject</th>
                            <th scope="col" class="px-6 py-3 rounded-tr-lg">Instructor</th>
                        </tr>
                    </thead>
                    <tbody>`;
                
                dayNames.forEach((day, index) => {
                    if (index === 0) return; // Skip Sunday
                    const classes = timetableData[index] || [];
                    if (classes.length > 0) {
                        tableHTML += `<tr class="border-b dark:border-gray-700">`;
                        tableHTML += `<td rowspan="${classes.length}" class="px-6 py-4 font-medium text-gray-900 dark:text-white align-top bg-white/10 dark:bg-gray-800/10">${day}</td>`;
                        
                        classes.forEach((cls, clsIndex) => {
                            if (clsIndex > 0) tableHTML += `<tr class="border-b dark:border-gray-700">`;
                            tableHTML += `<td class="px-6 py-4">${cls.start} - ${cls.end}</td>`;
                            tableHTML += `<td class="px-6 py-4 font-semibold">${cls.subject}</td>`;
                            tableHTML += `<td class="px-6 py-4">${cls.instructor}</td>`;
                            tableHTML += `</tr>`;
                        });
                    }
                });

                tableHTML += `</tbody></table>`;
                timetableContainer.innerHTML = tableHTML;
            };

            const showModal = () => {
                generateTimetableHTML();
                timetableModal.classList.remove('hidden');
                timetableModal.classList.add('flex', 'active');
            };
            const hideModal = () => {
                timetableModal.classList.remove('active');
                timetableModal.classList.add('hidden');
                timetableModal.classList.remove('flex');
            };

            // --- EVENT LISTENERS & INITIALIZATION ---
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            viewTimetableBtn.addEventListener('click', showModal);
            closeModalBtn.addEventListener('click', hideModal);
            timetableModal.addEventListener('click', (e) => {
                if (e.target === timetableModal) hideModal();
            });

            // Initial Setup
            requestNotificationPermission();
            loadTodaysSchedule();
            loadTasks();
             // Refresh the current class indicator every minute
            setInterval(loadTodaysSchedule, 60000);
        });
    </script>
</body>
</html>
